{
	"title":"在Oracle中查询表的大小和表空间的大小",
	"updateTime":"2018-04-24 00:20:43",
	"content":"在Oracle中查询表的大小和表空间的大小\r\n\r\n有两种含义的表大小。一种是分配给一个表的物理空间数量，而不管空间是否被使用。可以这样查询获得字节数：\r\n\r\nselect segment_name, bytes \r\nfrom user_segments \r\nwhere segment_type \u003d \u0027TABLE\u0027; \r\n或者\r\n   Select Segment_Name,Sum(bytes)/1024/1024 From User_Extents Group By Segment_Name\r\n\r\n另一种表实际使用的空间。这样查询：\r\n\r\nanalyze table emp compute statistics; \r\nselect num_rows * avg_row_len \r\nfrom user_tables \r\nwhere table_name \u003d \u0027EMP\u0027;\r\n\r\n查看每个表空间的大小\r\nSelect Tablespace_Name,Sum(bytes)/1024/1024 From Dba_Segments Group By Tablespace_Name\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n\r\n1.查看剩余表空间大小\r\n\r\n \r\n\r\nSELECT tablespace_name 表空间,sum(blocks*8192/1000000) 剩余空间M FROM dba_free_space GROUP BY tablespace_name;\r\n\r\n \r\n\r\n2.检查系统中所有表空间总体空间\r\n\r\nselect b.name,sum(a.bytes/1000000)总空间 from v$datafile a,v$tablespace b where a.ts#\u003db.ts# group by b.name;\r\n\r\n\r\n　　1、查看Oracle数据库中表空间信息的工具方法：\r\n\r\n　　使用oracle enterprise manager console工具，这是oracle的客户端工具，当安装oracle服务器或客户端时会自动安装此工具，在windows操作系统上完成oracle安装后，通过下面的方法登录该工具：开始菜单——程序——Oracle-OraHome92——Enterprise Manager Console(单击)——oracle enterprise manager console登录——选择‘独立启动’单选框——‘确定’ —— ‘oracle enterprise manager console，独立’ ——选择要登录的‘实例名’ ——弹出‘数据库连接信息’ ——输入’用户名/口令’ (一般使用sys用户)，’连接身份’选择选择SYSDBA——‘确定’，这时已经成功登录该工具，选择‘存储’ ——表空间，会看到如下的界面，该界面显示了表空间名称，表空间类型，区管理类型，以”兆”为单位的表空间大小，已使用的表空间大小及表空间利用率。\r\n\r\n　　图1 表空间大小及使用率\r\n\r\n　　2、查看Oracle数据库中表空间信息的命令方法：\r\n\r\n　　通过查询数据库系统中的数据字典表(data dictionary tables)获取表空间的相关信息，首先使用客户端工具连接到数据库,这些工具可以是SQLPLUS字符工具、TOAD、PL/SQL等,连接到数据库后执行如下的查询语句：\r\n\r\n　　select\r\n\r\n　　a.a1 表空间名称,\r\n\r\n　　c.c2 类型,\r\n\r\n　　c.c3 区管理,\r\n\r\n　　b.b2/1024/1024 表空间大小M,\r\n\r\n　　(b.b2-a.a2)/1024/1024 已使用M,\r\n\r\n　　substr((b.b2-a.a2)/b.b2*100,1,5) 利用率\r\n\r\n　　from\r\n\r\n　　(select tablespace_name a1, sum(nvl(bytes,0)) a2 from dba_free_space group by tablespace_name) a,\r\n\r\n　　(select tablespace_name b1,sum(bytes) b2 from dba_data_files group by tablespace_name) b,\r\n\r\n　　(select tablespace_name c1,contents c2,extent_management c3 from dba_tablespaces) c\r\n\r\n　　where a.a1\u003db.b1 and c.c1\u003db.b1;\r\n\r\n　　该语句通过查询dba_free_space，dba_data_files，dba_tablespaces这三个数据字典表，得到了表空间名称，表空间类型，区管理类型，以”兆”为单位的表空间大小，已使用的表空间大小及表空间利用率。dba_free_space表描述了表空间的空闲大小，dba_data_files表描述了数据库中的数据文件，dba_tablespaces表描述了数据库中的表空间。\r\n\r\n　　上面语句中from子句后有三个select语句，每个select语句相当于一个视图，视图的名称分别为a、b、c，通过它们之间的关联关系，我们得到了表空间的相关信息。\r\n\r\n　　语句执行结果如下：\r\n\r\n　　\r\n\r\n表空间名称 类型 区管理 表空间大小M 已使用M 利用率 \r\nCWMLITE PERMANENT LOCAL 20 9.375 46.87 \r\nDRSYS PERMANENT LOCAL 20 9.6875 48.43 \r\nEXAMPLE PERMANENT LOCAL 149.375 149.25 99.91 \r\nINDX PERMANENT LOCAL 25 0.0625 0.25 \r\nODM PERMANENT LOCAL 20 9.375 46.87 \r\nSYSTEM PERMANENT LOCAL 400 397.375 99.34 \r\nTOOLS PERMANENT LOCAL 10 6.0625 60.62 \r\nUNDOTBS1 UNDO LOCAL 200 5.9375 2.968 \r\nUSERS PERMANENT LOCAL 25 0.0625 0.25 \r\nXDB PERMANENT LOCAL 38.125 37.9375 99.5 \r\n　　上面描述中分别介绍了查看Oracle数据库中表空间信息的工具方法和命令方法。\r\n\r\n \r\n\r\n　　1、查看Oracle数据库中数据文件信息的工具方法：\r\n\r\n　　使用上面介绍过的方法登录oracle enterprise manager console工具，选择‘存储’ ——数据文件，会看到如下的界面，该界面显示了数据文件名称，表空间名称，以”兆”为单位的数据文件大小，已使用的数据文件大小及数据文件利用率。\r\n\r\n　　\r\n\r\n　　图2 数据文件大小及使用率\r\n\r\n        2、查看Oracle数据库中数据文件信息的命令方法：\r\n\r\n　　通过查询数据库系统中的数据字典表(data dictionary tables)获取数据文件的相关信息，首先使用客户端工具连接到数据库,这些工具可以是SQLPLUS字符工具、TOAD、PL/SQL等,连接到数据库后执行如下的查询语句：\r\n\r\n　　select\r\n\r\n　　b.file_name 物理文件名,\r\n\r\n　　b.tablespace_name 表空间,\r\n\r\n　　b.bytes/1024/1024 大小M,\r\n\r\n　　(b.bytes-sum(nvl(a.bytes,0)))/1024/1024 已使用M,\r\n\r\n　　substr((b.bytes-sum(nvl(a.bytes,0)))/(b.bytes)*100,1,5) 利用率\r\n\r\n　　from dba_free_space a,dba_data_files b\r\n\r\n　　where a.file_id\u003db.file_id\r\n\r\n　　group by b.tablespace_name,b.file_name,b.bytes\r\n\r\n　　order by b.tablespace_name\r\n\r\n　　语句执行结果如下：\r\n\r\n　　\r\n\r\n物理文件名 表空间 大小M 已使用M 利用率 \r\nG:/ORACLE/ORADATA/ORA92/CWMLITE01.DBF CWMLITE 20 9.375 46.87 \r\nG:/ORACLE/ORADATA/ORA92/DRSYS01.DBF DRSYS 20 9.6875 48.43 \r\nG:/ORACLE/ORADATA/ORA92/EXAMPLE01.DBF EXAMPLE 149.375 149.25 99.91 \r\nG:/ORACLE/ORADATA/ORA92/INDX01.DBF INDX 25 0.0625 0.25 \r\nG:/ORACLE/ORADATA/ORA92/ODM01.DBF ODM 20 9.375 46.87 \r\nG:/ORACLE/ORADATA/ORA92/SYSTEM01.DBF SYSTEM 400 397.375 99.34 \r\nG:/ORACLE/ORADATA/ORA92/TOOLS01.DBF TOOLS 10 6.0625 60.62 \r\nG:/ORACLE/ORADATA/ORA92/UNDOTBS01.DBF UNDOTBS1 200 5.9375 2.968 \r\nG:/ORACLE/ORADATA/ORA92/USERS01.DBF USERS 25 0.0625 0.25 \r\nG:/ORACLE/ORADATA/ORA92/XDB01.DBF XDB 38.125 37.9375 99.5 \r\n　　上明描述中分别介绍了查看Oracle数据库中数据文件信息的工具方法和命令方法。\r\n\r\n \r\n\r\n　　在oracle数据库中，临时表空间主要用于用户在使用order by 、group by语句进行排序和汇总时所需的临时工作空间。要查询数据库中临时表空间的名称，大小及数据文件，可以查询数据字典dba_tablespaces及dba_data_files。命令如下：\r\n\r\n　　select\r\n\r\n　　a.talbespace_name 表空间名称,\r\n\r\n　　b.bytes 大小bytes,\r\n\r\n　　b.file_name 数据文件名\r\n\r\n　　from dba_tablespaces a, dba_data_files b\r\n\r\n　　Where a.talbespace_name\u003db.talbespace_name and a.contents\u003d’TEMPORARY’;\r\n\r\n　　查询结果如下：\r\n\r\n　　表空间名称大小bytes数据文件名\r\n\r\n　　TEMPONLINEG:/ORACLE/ORADATA/ORA92/TEMP01.DBF\r\n\r\n　　从oracle 9i开始，可以创建Temporary tablespace类表空间，即“临时“表空间，这类表空间使用临时文件。临时文件的信息被存储在数据字典V$tempfile中。命令如下：\r\n\r\n　　Select file#，status，name from V$tempfile;\r\n\r\n　　查询数据字典V$tempfile结果如下：\r\n\r\n　　\r\n\r\nFILE# status NAME \r\n1 ONLINE G:/ORACLE/ORADATA/ORA92/TEMP01.DBF \r\n　　在上面介绍的方法中，建议掌握命令方法,因为你的环境可能没有图形工具，而SQLPLUS一般情况下都是可以使用的，有了命令脚本，很容易得到表空间和数据文件的相关信息。另外，数据库管理员应该多整理命令脚本，在需要时直接执行脚本以提高工作效率。\r\n\r\n　　在数据库管理员的日常工作中，应该经常查询表空间的利用率，按照数据库系统的具体情况估算表空间的增长量，当表空间的利用率超过90%时，要及时采取措施，如清理历史表、历史数据以释放空间，向表空间中添加新的数据文件，扩展现有数据文件大小等方法来降低表空间的利用率，避免表空间利用率接近100%时，将产生空间不够的错误。\r\n\r\n \r\n\r\n1.查询oracle表空间的使用情况\r\n\r\n select b.file_id　　文件ID,\r\n　　b.tablespace_name　　表空间,\r\n　　b.file_name　　　　　物理文件名,\r\n　　b.bytes　　　　　　　总字节数,\r\n　　(b.bytes-sum(nvl(a.bytes,0)))　　　已使用,\r\n　　sum(nvl(a.bytes,0))　　　　　　　　剩余,\r\n　　sum(nvl(a.bytes,0))/(b.bytes)*100　剩余百分比\r\n　　from dba_free_space a,dba_data_files b\r\n　　where a.file_id\u003db.file_id\r\n　　group by b.tablespace_name,b.file_name,b.file_id,b.bytes\r\n　　order by b.tablespace_name\r\n\r\n \r\n\r\n2.查询oracle系统用户的默认表空间和临时表空间\r\n\r\nselect default_tablespace,temporary_tablespace from dba_users\r\n\r\n \r\n\r\n 3.查询单张表的使用情况\r\n\r\nselect segment_name,bytes from dba_segments where segment_name \u003d \u0027RE_STDEVT_FACT_DAY\u0027 and owner \u003d USER\r\n\r\nRE_STDEVT_FACT_DAY是您要查询的表名称\r\n\r\n \r\n\r\n4.查询所有用户表使用大小的前三十名\r\n\r\nselect * from (select segment_name,bytes from dba_segments where owner \u003d USER order by bytes desc ) where rownum \u003c\u003d 30\r\n\r\n \r\n\r\n5.查询当前用户默认表空间的使用情况\r\n\r\nselect tablespacename,sum(totalContent),sum(usecontent),sum(sparecontent),avg(sparepercent) \r\nfrom \r\n(\r\nSELECT b.file_id as id,b.tablespace_name as tablespacename,b.bytes as totalContent,(b.bytes-sum(nvl(a.bytes,0))) as usecontent,sum(nvl(a.bytes,0)) as sparecontent,sum(nvl(a.bytes,0))/(b.bytes)*100  as sparepercent \r\nFROM dba_free_space a,dba_data_files b\r\nWHERE a.file_id\u003db.file_id and b.tablespace_name \u003d (select default_tablespace from dba_users where username \u003d user)  \r\ngroup by b.tablespace_name,b.file_name,b.file_id,b.bytes\r\n) \r\nGROUP BY tablespacename\r\n\r\n \r\n\r\n6.查询用户表空间的表\r\n\r\nselect   *  from user_tables\r\n\r\n\r\n来源： http://blog.csdn.net/cosio/article/details/3978747",
	"sort":7
}